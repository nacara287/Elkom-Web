@model And.ElkomMuhasebe.UI.WEB.Controllers.CARI_HAREKETController.modelimiz
@{
    ViewBag.Title = "Çek İşlemleri";
    Layout = "~/Views/Shared/yeni.cshtml";
}

<div class="card">
    <div class="card-body p-3">
        <div class="form-row">
            <div class="form-group col-md-4">
                <label>Cari Adı/Kodu</label>
                <select id="CariKodu" onchange="tabloyenile()" class="form-control  select2bs4" style="width: 100%;"
>
                </select>
            </div>
            <div class="form-group col-md-2">
                <label>Makbuz Numarası</label>
                <input id="FisNo" type="text" class="form-control form-control-sm" placeholder="Makbuz Numarası" readonly required="" value="@("CEKMKBZ" + (Model.CARI_FIs+1).ToString())">
            </div>
            <div class="form-group col-md-2">
                <label>İşlem Tarihi</label>
                <input id="Tarih" type="datetime-local" class="form-control form-control-sm" value="@DateTime.Now.Year.ToString("D" + 4)-@DateTime.Now.Month.ToString("D" + 2)-@DateTime.Now.Day.ToString("D" + 2)@Html.Raw("T")@DateTime.Now.Hour.ToString("D" + 2):@DateTime.Now.Minute.ToString("D" + 2)">
            </div>
            <div class="form-group col-md-2">
                <label>Sorumluluk Merkezi</label>
                <select id="Smerkezi" class="form-control form-control-sm">
                    @{ if (Model.sORUMLULUK_MERKEZIs != null)
                        {
                            foreach (var item in Model.sORUMLULUK_MERKEZIs)
                            {
                                <option>@item.ACIKLAMA</option>
                            }
                        }
                    }
                </select>
            </div>
            <div class="form-group col-md-6">
                <label>İşlem Notu</label>
                <input id="Not" type="text" class="form-control form-control-sm" placeholder="Not">
            </div>
        </div>
        <!--  Liste -->
        <div class="table-responsive">
            <table id="bootstrap-table" class="table">
                <thead>
                    <tr>
                        <th data-field="HAREKET" class="text-center" data-sortable="true">HAREKET</th>
                        <th data-field="KASA" data-sortable="true">KASA</th>
                        <th data-field="PORTFÖYNO" data-sortable="true">PORTFÖYNO</th>
                        <th data-field="ACIKLAMA" data-sortable="true">AÇIKLAMA</th>
                        <th data-field="VADE">VADE</th>
                        <th data-field="TUTAR" class="countable" data-sortable="true" data-footer-formatter="priceFormatter">TUTAR</th>
                        <th></th>
                    </tr>
                    <tr>
                        <td>
                            <select class="custom-select custom-select-sm" name="Hareket" id="Hareket" onchange="ceksenetayarla()">
                                <option selected>Seçiniz</option>
                                <option value="0">ÇekÖdeme</option>
                                <option value="1">ÇekTahsil</option>
                                <option value="2">KarşılıksızÇek</option>
                                <option value="3">Çekİade</option>
                         
                                <option value="5">FirmaÇekİade</option>
                            </select>
                        </td>
                        <td>
                            <div class="input-group input-group-sm">
                                <input type="text"  name="Kasa" id="Kasa" class="form-control" placeholder="Kasa Adı"aria-describedby="button-kasa-adi">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button" id="button-kasa-adi" data-toggle="modal"  data-target="#ModalKasaSec" onclick="butonkasalistele()">
                                        <i class="fa fa-search" aria-hidden="true"></i></button>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="input-group input-group-sm">
                                <input type="text" class="form-control" name="Adı" id="Adı" placeholder="Portfoy No">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button" id="ceksenetgoster" data-toggle="modal" data-target="#ModalFIRMADAKICEKLER">
                                        <i class="fa fa-search" aria-hidden="true"></i></button>
                                </div>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control form-control-sm" value="Açıklama"readonly id="Açıklama">
                        </td>
                        <td>
                            <input type="date" class="form-control form-control-sm" name="Vade" id="Vade"readonly  value="@DateTime.Now.Year.ToString("D" + 4)-@DateTime.Now.Month.ToString("D" + 2)-@DateTime.Now.Day.ToString("D" + 2)">
                        </td>
                        <td>
                            <input type="text" class="form-control form-control-sm text-right" value="0.00" readonly name="Tutar" id="Tutar" placeholder="Tutar" required="">
                        </td>
                        <td w="">
                            <button type="button" id="addRowBtn" onclick="butonlistele()"  class="btn btn-success btn-sm btn-rounded">
                                <span class="icon text-white-50">
                                    <i class="fas fa-plus"></i>
                                </span>
                            </button>

                        </td>

                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
    <div class="card-footer ">
        <div class="row">
            <div class="col-md-6">
                <p>Text: </p>
                <p>Text: </p>
                <p>Text: </p>
            </div>
            <div class="col-md-6">                
                <div class="form-group row mb-1">
                    <label for="ToplamTutar" class="col-sm-6 text-right col-form-label">Toplam Tutar</label>
                    <div class="col-sm-6">
                        <input id="toplam" type="text" class="form-control text-right form-control-sm" placeholder="0.00" readonly>
                    </div>
                </div>
            </div>
        </div>  
    </div>
</div>             


<!-- Butonlar -->
<div class="py-2">
    <button type="button" onclick="butongonder()" class="btn btn-sm btn-primary btn-icon-split">
        <span class="icon text-white-50">
            <i class="fas fa-save"></i>
        </span>
        <span class="text">Kaydet</span>
    </button>
    <a href="@Url.RequestContext.HttpContext.Request.Url.ToString()" class="btn btn-sm btn-secondary btn-icon-split">
        <span class="icon text-white-50">
            <i class="fas fa-power-off"></i>
        </span>
        <span class="text">İptal</span>
    </a>
</div>


<div class="modal fade" id="ModalKasaSec" tabindex="-2" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="vertical-alignment-helper">
        <div class="modal-dialog modal-xl  vertical-align-center" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">Kasa Seç</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>

                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table id="kasatablo" class="table-bordered table-sm" data-maintain-meta-data="true" data-maintain-selected="true" data-show-search-clear-button="true" data-advanced-search="true"
                                data-id-table="advancedTable" data-show-footer="true" data-footer-style="footerStyle"
                                data-single-select="true">
                            <thead>
                                <tr>
                                    <th data-field="state" class="no-print" data-checkbox="true"></th>


                                    <th data-field="KASAKODU" data-footer-formatter="idFormatter" data-sortable="true">Kasa Kodu</th>

                                    <th data-field="KASAADI" data-sortable="true">Açıklama</th>

                                    <th data-field="TIPI" data-sortable="true">Açıklama</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table><div id="FaturaCariSecDataTablo_processing" class="dataTables_processing panel panel-default" style="display: none;">İşleniyor...</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="butonkasagetir()" data-dismiss="modal">Seç</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Vazgeç</button>
                </div>
                
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ModalPORTFOYDAKICEKLER" tabindex="-6" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="vertical-alignment-helper">
        <div class="modal-dialog modal-xl  vertical-align-center" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">Portfoydaki Çekler</h4>
                   
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>

                </div>

                <div class="modal-body">
                    <div class="table-responsive">
                        <table id="cektablosu" class="table-bordered table-sm" data-show-search-clear-button="true"
                                data-show-footer="true" data-footer-style="footerStyle" data-show-print="true"
                                data-single-select="true" data-show-refresh="true" data-icon-size="sm"
                                data-side-pagination="server"
                                data-pagination="true"
                                data-page-size="10"
                                 data-page-list="[10, 20, 50, 100, 200, 300]" data-show-export="true" data-reorderable-columns="true">
                            <thead>
                                <tr>


                                    <th data-field="state" class="no-print" data-print-ignore="true" data-checkbox="true"></th>
                                    <th data-field="ID" data-print-ignore="true" class="text-center" data-sortable="true" data-footer-formatter="idFormatter" data-visible="false">ID</th>
                                    <th data-field="TARIH" data-sortable="true">Tarih</th>
                                    <th data-field="PORTFOYNO" data-sortable="true">Portfoy No</th>

                                    <th data-field="ALINANKISIKODU" data-sortable="true">Alınan Kişi Kodu</th>
                                    <th data-field="ALINANKISIADI" data-sortable="true">Alınan Kişi Adı<a class="no-print" style="color:transparent;">-----------------------------------------</a></th>
                                     <th data-field="ACIKLAMA" data-sortable="true">Açıklama<a class="no-print" style="color:transparent;">-----------------------------------------</a></th>


                                    <th data-field="TUTAR" data-align="right" data-footer-formatter="priceFormatter" data-sortable="true" data-formatter="numberformatter">Tutar</th>

                                    <th data-field="VADE" data-sortable="true">Vade<a class="no-print" style="color:transparent;">-----------------------------------------</a></th>

                                    <th data-field="CEKDURUMU" data-sortable="true">Çek Durumu</th>


                                </tr>
                            </thead>

                            <tbody>
                            </tbody>

                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    
                    <button type="button" class="btn btn-primary" onclick="butoncekgetir()" data-dismiss="modal">Seç</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Vazgeç</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="ModalFIRMADAKICEKLER" tabindex="-7" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="vertical-alignment-helper">
        <div class="modal-dialog modal-xl  vertical-align-center" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">Firmadaki Senetler</h4>

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>

                </div>

                <div class="modal-body">
                    <div class="table-responsive">
                        <table id="firmacektablosu" class="table-bordered table-sm" data-show-search-clear-button="true"
                                data-show-footer="true" data-footer-style="footerStyle" data-show-print="true"
                                data-single-select="true" data-show-refresh="true" data-icon-size="sm"
                                data-side-pagination="server"
                                data-pagination="true"
                                data-page-size="10"
                                 data-page-list="[10, 20, 50, 100, 200, 300]" data-show-export="true" data-reorderable-columns="true">
                            <thead>
                                <tr>

                                    <th data-field="state" class="no-print" data-checkbox="true"></th>
                                    <th data-field="ID" class="text-center" data-sortable="true" data-footer-formatter="idFormatter" data-visible="false">ID</th>
                                    <th data-field="TARIH" data-sortable="true">Tarih</th>
                                    <th data-field="PORTFOYNO" data-sortable="true">Portfoy No</th>
                                    <th data-field="VERILENKISIKODU" data-sortable="true">Verilen Kişi Kodu</th>
                                    <th data-field="VERILENKISIADI" data-sortable="true">Verilen Kişi Adı</th>
                                     <th data-field="ACIKLAMA" data-sortable="true">Açıklama<a class="no-print" style="color:transparent;">-----------------------------------------</a></th>




                                    <th data-field="TUTAR" data-align="right" data-footer-formatter="priceFormatter" data-sortable="true" data-formatter="numberformatter">Tutar</th>
                                    <th data-field="VADE" data-sortable="true">Vade<a class="no-print" style="color:transparent;">-----------------------------------------</a></th>
                                    <th data-field="CEKDURUMU" data-sortable="true">Çek Durumu</th>


                                </tr>
                            </thead>

                            <tbody>
                            </tbody>

                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="butoncekgetir()" data-dismiss="modal">Seç</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Vazgeç</button>
                </div>
            </div>
        </div>
    </div>
</div>


@section script{
    <script type="text/javascript">


        var bakiyefiltre = null;
        var carid;
        var caridg;
        var carikodu;
        var kasaid;
        var kasadg;
            var kasakodu;
            var portfyno;
        var $table = $('#bootstrap-table');
        var $caritable = $('#caritablo');
            var $kasatable = $('#kasatablo');
        var $cek = $('#cektablosu');
        var $firmacek = $('#firmacektablosu');
        var parakuru;

        function carikurgetir() {
            $.ajax({
                type: "POST",

                dataType: "json",
                contentType: "application/json; charset=utf-8",
                url: "/CARI_BASLIK/getparabirimi/",
                data: JSON.stringify({
                    kod: document.getElementById("CariKodu").options[document.getElementById("CariKodu").selectedIndex].value
                }),
                success: function (result) {
                    if (result != "TRY") {
                        var sel = document.getElementById("ParaBirimi");

                        var opts = sel.options;
                        for (var opt, j = 0; opt = opts[j]; j++) {
                            if (opt.text == result.parabirimi) {
                                sel.selectedIndex = j;

                            } else {
                                opt.disabled = true;
                            }
                            kurgetir();
                        }
                    } else {
                        var sel = document.getElementById("ParaBirimi");

                        var opts = sel.options;
                        for (var opt, j = 0; opt = opts[j]; j++) {
                            if (opt.text == "TRY") {
                                sel.selectedIndex = j;

                            }
                            opt.disabled = false;


                        }
                        kurgetir();
                    }

                }
                ,
                error: function (result) {
                    toastr["error"]('error');
                }
            });
        }


        function tabloyenile() {
            $cek.bootstrapTable('refresh');
            $firmacek.bootstrapTable('refresh');
        };

        $('.select2').select2()



        //Initialize Select2 Elements
        $('.select2bs4').select2({
            theme: 'bootstrap4',
            placeholder: "Cari adı veya kodu ile ara",
            ajax: {
                url: '/CARI_BASLIK/getcarid',
                processResults: function (data) {
                    // Transforms the top-level key of the response object from 'items' to 'results'
                    return {
                        results: data

                    };
                }
                // Additional AJAX parameters go here; see the end of this chapter for the full code of this example
            }
        })
            function get_query_params(p) {



                var arr = [{ verismi: "VADE", deger: "01/01/2000", deger2: "01/01/2090", filtretipi: 4 }];
                arr.push({ verismi: "hareket.CEKDURUMU", deger: "0", deger2: "01/01/2090", filtretipi: 2 });
                if (document.getElementById("CariKodu").value != null && document.getElementById("CariKodu").value!="")
                arr.push({ verismi: "hareket.ALINANKISIID", deger: document.getElementById("CariKodu").value, deger2: "01/01/2090", filtretipi: 7 });

                if (p.sort != null) {
                    return {

                        extraParam: 'abc',
                        search: p.search,
                        sort: p.sort,
                        order: p.order,
                        limit: p.limit,
                        offset: p.offset,

                        sort: p.sort,

                        filterler: arr
                    }
                } else {
                    return {
                        extraParam: 'abc',
                        search: p.search,
                        sort: p.sort,
                        order: p.order,
                        limit: p.limit,
                        offset: p.offset,

                        sort: "ID",

                        filterler: arr
                    }

                }
        }
        function get_query_paramsfirma(p) {



            var arr = [{ verismi: "KESIDETARIHI", deger: "01/01/2000", deger2: "01/01/2090", filtretipi: 4 }];
            arr.push({ verismi: "hareket.CEKDURUMU", deger: "0", deger2: "01/01/2090", filtretipi: 2 });
            if (document.getElementById("CariKodu").value != null && document.getElementById("CariKodu").value != "")
            arr.push({ verismi: "hareket.VERILENKISIID", deger: document.getElementById("CariKodu").value, deger2: "01/01/2090", filtretipi: 7 });

            if (p.sort != null) {
                return {

                    extraParam: 'abc',
                    search: p.search,
                    sort: p.sort,
                    order: p.order,
                    limit: p.limit,
                    offset: p.offset,

                    sort: p.sort,

                    filterler: arr
                }
            } else {
                return {
                    extraParam: 'abc',
                    search: p.search,
                    sort: p.sort,
                    order: p.order,
                    limit: p.limit,
                    offset: p.offset,

                    sort: "ID",

                    filterler: arr
                }

            }
        }
            function ceksenetayarla() {

                var hareket = document.getElementById("Hareket").options[document.getElementById("Hareket").selectedIndex].value;

               if (hareket == 1 || hareket == 2||hareket == 3 || hareket ==4)
                   document.getElementById("ceksenetgoster").dataset.target = "#ModalPORTFOYDAKICEKLER";
               else {
                   document.getElementById("ceksenetgoster").dataset.target = "#ModalFIRMADAKICEKLER";
               }
           }

            function butoncekekle() {
                        document.getElementById("Adı").value = document.getElementById("FirmaPortfoyno").value;



                    }

        function butonkasalistele() {

        $.ajax({
            type: "POST",

            dataType: "json",
            contentType: "application/json; charset=utf-8",
            url: "/CARI_HAREKET/kasagetir/",
            data: JSON.stringify({
                kasatipi: "Nakit"
            }),
            success: function (result) {

                $kasatable.bootstrapTable('load', result);
            },
            error: function (result) {
                toastr["error"]('error');
            }
        });


    }

        function butoncarigetir() {

            carid = caridg;
            document.getElementById("CariKodu").value = carikodu;
            document.getElementById("ModalCariSec").style.display = "none";
            var sel = document.getElementById("ParaBirimi");
              var opts = sel.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.text == parakuru) {
      sel.selectedIndex = j;
      break;
                }

            }
                kurgetir();

        }
        function butonkasagetir() {

            kasaid = kasadg;
            document.getElementById("Kasa").value = kasakodu;
            document.getElementById("ModalKasaSec").style.display = "none";


        }
        function addRow(tableID) {

            var table = document.getElementById(tableID);

            var rowCount = table.rows.length;
            var row = table.insertRow(rowCount);

            var cell1 = row.insertCell(0);
            var element1 = document.createElement("input");
            element1.type = "text";
            element1.name = "txtbox[]";
            cell1.appendChild(element1);

            var cell2 = row.insertCell(1);
            var element2 = document.createElement("input");
            element2.type = "text";
            element2.name = "txtbox[]";
            cell2.appendChild(element2);

            var cell3 = row.insertCell(2);
            var element3 = document.createElement("input");
            element3.type = "text";
            element3.name = "txtbox[]";
            cell3.appendChild(element3);
            var cell4 = row.insertCell(3);
            var element4 = document.createElement("input");
            element4.type = "text";
            element4.name = "txtbox[]";
            cell4.appendChild(element4);

            var cell5 = row.insertCell(4);
            var element5 = document.createElement("input");
            element5.type = "text";
            element5.name = "txtbox[]";
            cell5.appendChild(element5);

            var cell6 = row.insertCell(5);
            var element6 = document.createElement("input");
            element6.type = "text";
            element6.name = "txtbox[]";
            cell6.appendChild(element6);
            var cell7 = row.insertCell(6);
            var element7 = document.createElement("input");
            element7.type = "text";
            element7.name = "txtbox[]";
            cell7.appendChild(element7);

        }

        $().ready(function () {

            $firmacek.bootstrapTable({

                type: "POST",
                url: "/CEK/VERILENFISDATA",
                method: 'post',
                contentType: 'application/x-www-form-urlencoded',
                queryParams: get_query_paramsfirma,

                clickToSelect: true,
                showRefresh: true,

                search: true,
                showToggle: true,
                showColumns: true,
                locale: 'tr-TR',
                searchAlign: 'left',
                formatShowingRows: function (pageFrom, pageTo, totalRows) {
                    return "Toplam " + totalRows+" Kayıt";
                },
                formatRecordsPerPage: function (pageNumber) {
                    return pageNumber + " Adet Listeleniyor";
                }

            });
            $firmacek.on('click-row.bs.table', function (e, row, $element) {
              

                document.getElementById("Adı").value = row.PORTFOYNO;

                portfyno = row.PORTFOYNO;
                document.getElementById("Tutar").value = row.TUTAR;
                document.getElementById("Açıklama").value = row.ACIKLAMA;
                document.getElementById("Vade").value = row.VADE;
            });
            $firmacek.on('check.bs.table', function (e, row, $element) {


                document.getElementById("Adı").value = row.PORTFOYNO;

                portfyno = row.PORTFOYNO;
                document.getElementById("Tutar").value = row.TUTAR;
                document.getElementById("Açıklama").value = row.ACIKLAMA;
                document.getElementById("Vade").value = row.VADE;
            });
            $firmacek.on('  dbl-click-row.bs.table', function (e, row, $element) {
                var check = false;
                var table = document.getElementById("bootstrap-table");
                var ths = table.getElementsByTagName('th');
                var tds = table.getElementsByClassName('portfoyno');
                for (var i = 0; i < tds.length; i++) {
                    if (tds[i].innerText == row.PORTFOYNO) {
                     
                            check = true;
                            toastr["error"]("Seçtiğiniz Çek Zaten Kalemde Ekli!");
                        
                    }

                }
                if (check == false) {
                    portfyno = row.PORTFOYNO;
                    document.getElementById("Tutar").value = row.TUTAR;
                    document.getElementById("Adı").value = row.PORTFOYNO;

                    document.getElementById("Açıklama").value = row.ACIKLAMA;
                    document.getElementById("Vade").value = row.VADE;
                    var table = document.getElementById("bootstrap-table");
                    var ths = table.getElementsByTagName('th');
                    var tds = table.getElementsByClassName('portfoyno');


                    $('#ModalFIRMADAKICEKLER').modal('hide');
                }

            });
            $cek.bootstrapTable({

                type: "POST",
                url: "/CEK/ALINANFISDATA",
                method: 'post',
                contentType: 'application/x-www-form-urlencoded',
                queryParams: get_query_params,

                clickToSelect: true,
                showRefresh: true,

                search: true,
                showToggle: true,
                showColumns: true,
                locale: 'tr-TR',
                searchAlign: 'left',
                formatShowingRows: function (pageFrom, pageTo, totalRows) {
                    return "Toplam " + totalRows+" Kayıt";
                },
                formatRecordsPerPage: function (pageNumber) {
                    return pageNumber + " Adet Listeleniyor";
                }

            });
            $cek.on('click-row.bs.table', function (e, row, $element) {
                var check = false;
                var table = document.getElementById("bootstrap-table");
                var ths = table.getElementsByTagName('th');
                var tds = table.getElementsByClassName('portfoyno');
                for (var i = 0; i < tds.length; i++) {
                    if (tds[i].innerText == row.PORTFOYNO) {

                        check = true;
                        toastr["error"]("Seçtiğiniz Çek Zaten Kalemde Ekli!");

                    }

                }
                if (check == false) {
                    portfyno = row.PORTFOYNO;
                    document.getElementById("Tutar").value = row.TUTAR;
                    document.getElementById("Adı").value = row.PORTFOYNO;

                    document.getElementById("Açıklama").value = row.ACIKLAMA;
                    document.getElementById("Vade").value = row.VADE;
                 
                }

            });
            $cek.on('check.bs.table', function (e, row, $element) {
                var check = false;
                var table = document.getElementById("bootstrap-table");
                var ths = table.getElementsByTagName('th');
                var tds = table.getElementsByClassName('portfoyno');
                for (var i = 0; i < tds.length; i++) {
                    if (tds[i].innerText == row.PORTFOYNO) {

                        check = true;
                        toastr["error"]("Seçtiğiniz Çek Zaten Kalemde Ekli!");

                    }

                }
                if (check == false) {
                    portfyno = row.PORTFOYNO;
                    document.getElementById("Tutar").value = row.TUTAR;
                    document.getElementById("Adı").value = row.PORTFOYNO;

                    document.getElementById("Açıklama").value = row.ACIKLAMA;
                    document.getElementById("Vade").value = row.VADE;
                 
                }
            });
            $cek.on('dbl-click-row.bs.table', function (e, row, $element) {
                var check = false;
                var table = document.getElementById("bootstrap-table");
                var ths = table.getElementsByTagName('th');
                var tds = table.getElementsByClassName('portfoyno');
                for (var i = 0; i < tds.length; i++) {
                    if (tds[i].innerText == row.PORTFOYNO) {
                       
                            check = true;
                            toastr["error"]("Seçtiğiniz Çek Zaten Kalemde Ekli!");
                       
                    }

                }
                if (check == false) {
                    portfyno = row.PORTFOYNO;
                    document.getElementById("Tutar").value = row.TUTAR;
                    document.getElementById("Adı").value = row.PORTFOYNO;

                    document.getElementById("Açıklama").value = row.ACIKLAMA;
                    document.getElementById("Vade").value = row.VADE;
                    $('#ModalPORTFOYDAKICEKLER').modal('hide');
                }

            });
            $caritable.bootstrapTable({


                clickToSelect: true,


                search: true,


                pagination: true,
                searchAlign: 'left',
                pageSize: 8,

                pageList: [8, 10, 25, 50, 100],
                locale: 'tr-TR',
                formatShowingRows: function (pageFrom, pageTo, totalRows) {
                    return "Toplam " + totalRows+" Kayıt";
                },
                formatRecordsPerPage: function (pageNumber) {
                    return pageNumber + " Adet Listeleniyor";
                },

            });

            $caritable.on('click-row.bs.table', function (e, row, $element) {
                caridg = row.ID;
                 carid = row.ID;
                carikodu = row.CARIKOD;

            });
            $caritable.on('dbl-click-row.bs.table', function (e, row, $element) {
                carid = row.ID;
                parakuru = row.PARABIRIMI;
                document.getElementById("CariKodu").value = row.CARIKOD;

                     $('#ModalCariSec').modal('hide');



            });

            //activate the tooltips after the data table is initialized
            $('[rel="tooltip"]').tooltip();

            $(window).resize(function () {
                $caritable.bootstrapTable('resetView');
            });



            $kasatable.bootstrapTable({

                clickToSelect: true,


                search: true,


                pagination: true,
                searchAlign: 'left',
                pageSize: 8,

                pageList: [8, 10, 25, 50, 100],
                locale: 'tr-TR',
                formatShowingRows: function (pageFrom, pageTo, totalRows) {
                    return "Toplam " + totalRows+" Kayıt";
                },
                formatRecordsPerPage: function (pageNumber) {
                    return pageNumber + " Adet Listeleniyor";
                },

            });

            $kasatable.on('click-row.bs.table', function (e, row, $element) {
                kasaidg = row.ID;
                kasakodu = row.KASAADI;
            });
            $kasatable.on('check.bs.table', function (e, row, $element) {
                kasaidg = row.ID;
                kasakodu = row.KASAADI;
            });
            $kasatable.on('  dbl-click-row.bs.table', function (e, row, $element) {
                kasaidg = row.ID;

                document.getElementById("Kasa").value = row.KASAADI;
                $('#ModalKasaSec').modal('hide');


            });

            //activate the tooltips after the data table is initialized
            $('[rel="tooltip"]').tooltip();

            $(window).resize(function () {
                $kasatable.bootstrapTable('resetView');
            });


        })
        function butonlistele() {

            $table.append('<tr data-index="0"><td >' + document.getElementById('Hareket').options[document.getElementById('Hareket').selectedIndex].text + '</td><td>' + document.getElementById('Kasa').value + '</td><td class="portfoyno">' + document.getElementById('Adı').value + '</td><td>' + document.getElementById('Açıklama').value + '</td><td>' + document.getElementById('Vade').value + '</td><td class="countable">' + numberformatter( document.getElementById('Tutar').value) + '</td><td> <button  type="button" id="deleteRowBtn" onclick="deleteRow(this)" class="btn btn-danger btn-sm btn-rounded">  <span class="icon text-white-50">    <i class="fas fa-trash-alt"></i> </span></button></td></tr>');
            yenile();






        }
            function yenile() {maskla();
                var sum = 0;

                var table = document.getElementById("bootstrap-table");
                var ths = table.getElementsByTagName('th');
                var tds = table.getElementsByClassName('countable');

                for (var i = 0; i < tds.length; i++) {
                    sum += isNaN(tds[i].innerText.replaceAll(",", "")) ? 0 : parseFloat(tds[i].innerText.replaceAll(",", ""));
                }

                document.getElementById("toplam").value = numberformatter(sum);


            }
        function deleteRow(btn) {
  var row = btn.parentNode.parentNode;
            row.parentNode.removeChild(row);
                yenile();
}
        function butongonder() {

            var arr = [];


            var oTable = document.getElementById('bootstrap-table');

            //gets rows of table
            var rowLength = oTable.rows.length;

            //loops through rows
            for (i = 2; i < rowLength; i++) {

                //gets cells of current row
                var oCells = oTable.rows.item(i).cells;

                //gets amount of cells of current row
                var cellLength = oCells.length;

                //loops through each cell in current row
                for (var j = 0; j < cellLength; j++) {

                    // get your cell info here

                    var cellVal = oCells.item(j).innerHTML;
                    var cellVal = oCells.item(j).innerHTML;
                    var Hareket;
                    var Kasa;
                    var Portfoyno;
                    var Acıklama;
                    var Vade;
                    var Tutar;
                    var Parabirimi;
                    var Parabirimi;
                    var Parakuru;
                    var NetTutar;
                    if (j == 0)
                        Hareket = oCells.item(j).innerHTML;
                    if (j == 1)
                        Kasa = oCells.item(j).innerHTML;
                    if (j == 2)
                        Portfoyno = oCells.item(j).innerHTML;
                    if (j == 3)
                        Acıklama = oCells.item(j).innerHTML;
                    if (j == 4)
                         Vade= oCells.item(j).innerHTML+'T'+'@DateTime.Now.Hour.ToString("D" + 2)'+':'+'@DateTime.Now.Second.ToString("D" + 2)';
                    if (j == 5)
                        Tutar = oCells.item(j).innerHTML;


                }
                arr.push({ HAREKET: Hareket, KASA: Kasa, PORTFOYNO: Portfoyno, VADE: Vade, ACIKLAMA: Acıklama, TUTAR: Tutar, PARABIRIMI: "", PARAKURU: "", NETTutar: "" });
            }

            if (document.getElementById("CariKodu").options[document.getElementById("CariKodu").selectedIndex] == null) {
                toastr["error"]('Lütfen Cari Seçiniz!');
            } else if (arr.length == 0) {
                toastr["error"]('Lütfen Kalem Ekleyiniz!');
            } else {
                $.ajax({
                    type: "POST",


                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    url: "/CEK/datagonder/",
                    data: JSON.stringify({
                        CARIKOD: document.getElementById("CariKodu").value,
                        FISNO: document.getElementById("FisNo").value,
                        TARIH: (document.getElementById("Tarih").value ),
                        NOT: document.getElementById("Not").value,
                        SORUMLULUK_MERKEZI: document.getElementById("Smerkezi").value,

                        gelenhareket: arr
                    })
                    ,
                    success: function (result) {
                        historysend("/CEK/AlınanFisler");
                        toastr["success"]("Başarıyla Kayıt Edildi!");
                        buton.disabled = false;
                    },
                    error: function (result) {
                        toastr["error"]('Lütfen Bilgileri Eksik  Ya da Yanlış Girmeyiniz');
                        buton.disabled = false;
                    }
                });
            }
        }

        function idFormatter() {
            return 'Toplam'
        }

        function nameFormatter(data) {
            return data.length
        }

            function numberformatter(value, row, index) {
                if (!value)
                    return "0.00";
                else {
                    return [

                        numberWithCommas((Number(value.toString().replace(",", "."))).toFixed(2))
                    ].join('');
                }
            }
            function numberWithCommas(x) {
                return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
            function priceFormatter(data) {
                var field = this.field

                var toplam = data.map(function (row) {
                    if (row[field])
                        return +Number(row[field].toString().replace(",", "."))
                    else {
                        return +Number("0")
                    }
                }).reduce(function (sum, i) {
                    return sum + i
                }, 0);
                return numberWithCommas(toplam) + " TL"
            }

        function footerStyle(column) {
            return {
                id: {
                    classes: 'uppercase'
                },
                name: {
                    css: { 'font-weight': 'normal' }
                },
                price: {
                    css: { color: 'red' }
                }
            }[column.field]
        }
    </script>
}
